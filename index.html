<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Healer Online - Challenge Edition</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes float-up-random {
            0% { transform: translate(-50%, 0) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--tw-translate-x), -60px) scale(1.2); opacity: 0; }
        }
        .animate-float-up {
            animation: float-up-random 0.8s ease-out forwards;
        }
        @keyframes particle-fade {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--move-x), var(--move-y)) scale(0); opacity: 0; }
        }
        .particle {
            position: absolute;
            pointer-events: none;
            animation: particle-fade 0.6s ease-out forwards;
        }
        @keyframes screen-shake {
            0%, 100% { transform: translate(0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-4px, -4px); }
            20%, 40%, 60%, 80% { transform: translate(4px, 4px); }
        }
        .shake { animation: screen-shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        
        @keyframes flash-red {
            0% { background-color: rgba(220, 38, 38, 0); }
            20% { background-color: rgba(220, 38, 38, 0.4); }
            100% { background-color: rgba(220, 38, 38, 0); }
        }
        .flash-hit { animation: flash-red 0.3s ease-out; }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .attack-gauge { transition: width 0.1s linear; }
        .boss-breathing { animation: pulse 2s infinite ease-in-out; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏ ---
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />,
                Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
                Zap: <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />,
                Flame: <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" />,
                User: (<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>),
                Activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2" />,
                AlertCircle: (<><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></>),
                Sword: (<><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5" /><line x1="13" y1="19" x2="19" y2="13" /><line x1="16" y1="16" x2="20" y2="20" /><line x1="19" y1="21" x2="20" y2="20" /><line x1="20" y1="20" x2="21" y2="19" /></>),
                Trophy: <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.45 1-1 1H8v2h8v-2h-1c-.55 0-1-.45-1-1v-2.34M12 2C7.58 2 4 5.58 4 10c0 1.94.7 3.72 1.86 5.11l1.41-1.41C6.47 12.63 6 11.37 6 10c0-3.31 2.69-6 6-6s6 2.69 6 6c0 1.37-.47 2.63-1.27 3.7l1.41 1.41C19.3 13.72 20 11.94 20 10c0-4.42-3.58-8-8-8z" />
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        const App = () => {
            const TICK_RATE = 100;
            const MAX_MANA = 200;

            // ÎÇúÏù¥ÎèÑÎ≥Ñ ÏÑ§Ï†ïÍ∞í
            const DIFFICULTY_CONFIG = {
                EASY: {
                    label: 'Ïù¥ÏßÄ',
                    bossMaxHp: 60000,
                    attackInterval: 3000,
                    enragedInterval: 1800,
                    manaRegen: 1.0,
                    damageMultiplier: 0.8,
                    color: 'text-green-400',
                    bgColor: 'bg-green-600'
                },
                NORMAL: {
                    label: 'ÎÖ∏Î©Ä',
                    bossMaxHp: 90000,
                    attackInterval: 2400,
                    enragedInterval: 1400,
                    manaRegen: 0.8,
                    damageMultiplier: 1.1,
                    color: 'text-yellow-400',
                    bgColor: 'bg-yellow-600'
                },
                HARD: {
                    label: 'ÌïòÎìú',
                    bossMaxHp: 130000,
                    attackInterval: 1800,
                    enragedInterval: 1000,
                    manaRegen: 0.5,
                    damageMultiplier: 1.5,
                    color: 'text-red-500',
                    bgColor: 'bg-red-600'
                }
            };

            const SKILL_DATA = {
                1: { name: 'ÏàúÍ∞Ñ ÏπòÏú†', mana: 15, cd: 1.2, icon: 'Heart', key: '1', color: 'text-green-400' },
                2: { name: 'Ïû¨ÏÉù(HoT)', mana: 20, cd: 4, icon: 'Activity', key: '2', color: 'text-emerald-300' },
                3: { name: 'Ïã†Ïùò Î≥¥Ìò∏Îßâ', mana: 25, cd: 7, icon: 'Shield', key: '3', color: 'text-blue-300' },
                4: { name: 'ÏÑ±Ïä§Îü¨Ïö¥ Ìè≠Î∞ú', mana: 50, cd: 12, icon: 'AlertCircle', key: '4', color: 'text-yellow-200' }
            };

            const [gameState, setGameState] = useState('START');
            const [difficulty, setDifficulty] = useState('NORMAL');
            const [bossHp, setBossHp] = useState(0);
            const [bossMaxHp, setBossMaxHp] = useState(0);
            const [mana, setMana] = useState(MAX_MANA);
            const [selectedTarget, setSelectedTarget] = useState(0);
            
            const [player, setPlayer] = useState({ hp: 500, maxHp: 500, shield: 0, hot: 0, emoji: 'üßô' });
            const [party, setParty] = useState([
                { id: 0, name: 'Ï†ÑÏÇ¨', role: 'Tank', hp: 1200, maxHp: 1200, hot: 0, shield: 0, dead: false, emoji: 'üõ°Ô∏è', key: 'Q', attackProgress: 0 },
                { id: 1, name: 'ÎèÑÏ†Å', role: 'DPS', hp: 600, maxHp: 600, hot: 0, shield: 0, dead: false, emoji: 'üó°Ô∏è', key: 'W', attackProgress: 0 },
                { id: 2, name: 'Î≤ïÏÇ¨', role: 'DPS', hp: 450, maxHp: 450, hot: 0, shield: 0, dead: false, emoji: 'ü™Ñ', key: 'E', attackProgress: 0 },
            ]);

            const [cooldowns, setCooldowns] = useState({ 1: 0, 2: 0, 3: 0, 4: 0 });
            const [logs, setLogs] = useState([{ msg: "ÎÇúÏù¥ÎèÑÎ•º ÏÑ†ÌÉùÌïòÍ≥† Ï†ÑÌà¨Î•º ÏãúÏûëÌïòÏÑ∏Ïöî.", type: "system", id: 'init-log' }]);
            
            const [combatEffects, setCombatEffects] = useState([]);
            const [particles, setParticles] = useState([]);
            const [bossAction, setBossAction] = useState('');
            const [hitTargets, setHitTargets] = useState([]);
            const [screenFlash, setScreenFlash] = useState(false);
            const [isShaking, setIsShaking] = useState(false);

            const gameLoopRef = useRef(null);
            const lastBossAttackRef = useRef(Date.now());

            const triggerScreenEffect = (type) => {
                if (type === 'damage') {
                    setScreenFlash(true);
                    setIsShaking(true);
                    setTimeout(() => { setScreenFlash(false); setIsShaking(false); }, 300);
                }
            };

            const spawnParticles = (targetId, type) => {
                const colors = { damage: '#ef4444', heal: '#4ade80', shield: '#60a5fa' };
                const newParticles = Array.from({ length: 8 }).map(() => ({
                    id: Math.random(),
                    targetId,
                    color: colors[type],
                    moveX: (Math.random() - 0.5) * 100 + 'px',
                    moveY: (Math.random() - 0.5) * 100 + 'px',
                }));
                setParticles(prev => [...prev, ...newParticles]);
                setTimeout(() => {
                    setParticles(prev => prev.filter(p => !newParticles.find(np => np.id === p.id)));
                }, 600);
            };

            const triggerCombatText = (targetId, value, type, isCrit = false) => {
                const id = Math.random();
                const randomX = (Math.random() - 0.5) * 40;
                setCombatEffects(prev => [...prev, { id, targetId, value, type, isCrit, x: randomX }]);
                spawnParticles(targetId, type);
                setTimeout(() => {
                    setCombatEffects(prev => prev.filter(e => e.id !== id));
                }, 800);
            };

            const damageTarget = (type, index, amount, isMajor = false) => {
                const config = DIFFICULTY_CONFIG[difficulty];
                const finalDamage = amount * config.damageMultiplier;

                if (isMajor) triggerScreenEffect('damage');

                if (type === 'player') {
                    setPlayer(prev => {
                        let remainingDamage = finalDamage;
                        let newShield = prev.shield;
                        if (newShield > 0) {
                            const absorbed = Math.min(newShield, remainingDamage);
                            newShield -= absorbed;
                            remainingDamage -= absorbed;
                            triggerCombatText(`p-player`, `Î∞©Ïñ¥Îê®`, "shield");
                        }
                        const newHp = Math.max(0, prev.hp - remainingDamage);
                        if (remainingDamage > 0) {
                            triggerCombatText(`p-player`, `-${Math.ceil(remainingDamage)}`, "damage", remainingDamage > 100);
                            setHitTargets(prevHit => [...prevHit, 'player']);
                            setTimeout(() => setHitTargets(prevHit => prevHit.filter(i => i !== 'player')), 200);
                        }
                        return { ...prev, hp: newHp, shield: newShield };
                    });
                } else {
                    setParty(prev => {
                        const newParty = [...prev];
                        if (newParty[index].dead) return prev;
                        let remainingDamage = finalDamage;
                        if (newParty[index].shield > 0) {
                            const absorbed = Math.min(newParty[index].shield, remainingDamage);
                            newParty[index].shield -= absorbed;
                            remainingDamage -= absorbed;
                            triggerCombatText(`p-${index}`, `Î∞©Ïñ¥Îê®`, "shield");
                        }
                        if (remainingDamage > 0) {
                            newParty[index].hp = Math.max(0, newParty[index].hp - remainingDamage);
                            triggerCombatText(`p-${index}`, `-${Math.ceil(remainingDamage)}`, "damage", remainingDamage > 150);
                            setHitTargets(prevHit => [...prevHit, index]);
                            setTimeout(() => setHitTargets(prevHit => prevHit.filter(i => i !== index)), 200);
                        }
                        if (newParty[index].hp <= 0 && !newParty[index].dead) {
                            newParty[index].dead = true;
                            addLog(`${newParty[index].name} ÏÇ¨Îßù!`, "error");
                        }
                        return newParty;
                    });
                }
            };

            const healTarget = (type, index, amount) => {
                const isCrit = Math.random() > 0.85;
                const finalHeal = isCrit ? amount * 1.8 : amount;

                if (type === 'player') {
                    setPlayer(prev => {
                        const actualHeal = Math.min(prev.maxHp - prev.hp, finalHeal);
                        if (actualHeal > 0 || isCrit) {
                            triggerCombatText(`p-player`, `${isCrit ? '‚≠ê' : ''}+${Math.ceil(finalHeal)}`, "heal", isCrit);
                        }
                        return { ...prev, hp: prev.hp + actualHeal };
                    });
                } else {
                    setParty(prev => {
                        const newParty = [...prev];
                        if (newParty[index].dead) return prev;
                        const actualHeal = Math.min(newParty[index].maxHp - newParty[index].hp, finalHeal);
                        if (actualHeal > 0 || isCrit) {
                            newParty[index].hp += actualHeal;
                            triggerCombatText(`p-${index}`, `${isCrit ? '‚≠ê' : ''}+${Math.ceil(finalHeal)}`, "heal", isCrit);
                        }
                        return newParty;
                    });
                }
            };

            const castSpell = useCallback((spellId) => {
                if (gameState !== 'PLAYING') return;
                const spell = SKILL_DATA[spellId];
                if (mana < spell.mana) { addLog("ÎßàÎÇò Î∂ÄÏ°±!", "error"); return; }
                if (cooldowns[spellId] > 0) return;

                const targetType = selectedTarget === 3 ? 'player' : 'party';
                const targetIdx = selectedTarget === 3 ? null : selectedTarget;

                if (spellId === 1) healTarget(targetType, targetIdx, 180);
                if (spellId === 2) {
                    if (targetType === 'player') {
                        setPlayer(prev => ({ ...prev, hot: 12 }));
                        triggerCombatText(`p-player`, "Ïû¨ÏÉù", "heal");
                    } else {
                        setParty(prev => {
                            const next = [...prev];
                            next[targetIdx].hot = 12;
                            triggerCombatText(`p-${targetIdx}`, "Ïû¨ÏÉù", "heal");
                            return next;
                        });
                    }
                }
                if (spellId === 3) {
                    if (targetType === 'player') {
                        setPlayer(prev => ({ ...prev, shield: 300 }));
                        triggerCombatText(`p-player`, "Î≥¥Ìò∏Îßâ", "shield");
                    } else {
                        setParty(prev => {
                            const next = [...prev];
                            next[targetIdx].shield = 350;
                            triggerCombatText(`p-${targetIdx}`, "Î≥¥Ìò∏Îßâ", "shield");
                            return next;
                        });
                    }
                }
                if (spellId === 4) {
                    party.forEach((_, i) => healTarget('party', i, 120));
                    healTarget('player', null, 100);
                    addLog("ÏÑ±Ïä§Îü¨Ïö¥ Ìè≠Î∞ú!", "success");
                }

                setMana(m => Math.max(0, m - spell.mana));
                setCooldowns(prev => ({ ...prev, [spellId]: spell.cd * 10 }));
            }, [gameState, mana, cooldowns, selectedTarget, party]);

            const addLog = (msg, type = "normal") => {
                const newId = `${Date.now()}-${Math.random()}`;
                setLogs(prev => [{ msg, type, id: newId }, ...prev].slice(0, 8));
            };

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (gameState !== 'PLAYING') return;
                    if (['1', '2', '3', '4'].includes(e.key)) castSpell(parseInt(e.key));
                    if (e.key.toUpperCase() === 'Q') setSelectedTarget(0);
                    if (e.key.toUpperCase() === 'W') setSelectedTarget(1);
                    if (e.key.toUpperCase() === 'E') setSelectedTarget(2);
                    if (e.key.toUpperCase() === 'S') setSelectedTarget(3);
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [gameState, castSpell]);

            useEffect(() => {
                if (gameState === 'PLAYING') {
                    const config = DIFFICULTY_CONFIG[difficulty];
                    gameLoopRef.current = setInterval(() => {
                        setMana(m => Math.min(MAX_MANA, m + config.manaRegen));
                        setCooldowns(prev => {
                            const next = { ...prev };
                            Object.keys(next).forEach(k => { if (next[k] > 0) next[k] -= 1; });
                            return next;
                        });

                        const isBossEnraged = bossHp < bossMaxHp * 0.35;

                        // ÌååÌã∞ ÏóÖÎç∞Ïù¥Ìä∏
                        setParty(prev => {
                            let totalDpsThisTick = 0;
                            const next = prev.map((m, i) => {
                                if (m.dead) return m;
                                const speed = m.role === 'Tank' ? 10 : (m.name === 'ÎèÑÏ†Å' ? 18 : 8);
                                let newProgress = m.attackProgress + speed;
                                if (newProgress >= 100) {
                                    const damage = (m.role === 'Tank' ? 600 : (m.name === 'Î≤ïÏÇ¨' ? 3800 : 2200));
                                    totalDpsThisTick += damage;
                                    newProgress = 0;
                                    triggerCombatText('boss', `-${damage}`, 'damage');
                                }
                                let nextHp = m.hp;
                                let nextHot = m.hot;
                                if (m.hot > 0) {
                                    nextHp = Math.min(m.maxHp, m.hp + 20);
                                    nextHot = m.hot - 1;
                                    if (m.hot % 4 === 0) triggerCombatText(`p-${i}`, `+20`, "heal");
                                }
                                return { ...m, hp: nextHp, hot: nextHot, attackProgress: newProgress };
                            });
                            if (totalDpsThisTick > 0) setBossHp(h => Math.max(0, h - totalDpsThisTick / 10));
                            return next;
                        });

                        // ÌîåÎ†àÏù¥Ïñ¥ ÏóÖÎç∞Ïù¥Ìä∏
                        setPlayer(prev => {
                            let nextHp = prev.hp;
                            let nextHot = prev.hot;
                            if (prev.hot > 0) {
                                nextHp = Math.min(prev.maxHp, prev.hp + 15);
                                nextHot = prev.hot - 1;
                                if (prev.hot % 4 === 0) triggerCombatText(`p-player`, `+15`, "heal");
                            }
                            return { ...prev, hp: nextHp, hot: nextHot };
                        });

                        // Î≥¥Ïä§ Í≥µÍ≤©
                        const now = Date.now();
                        const attackInterval = isBossEnraged ? config.enragedInterval : config.attackInterval;
                        if (now - lastBossAttackRef.current > attackInterval) {
                            lastBossAttackRef.current = now;
                            const rand = Math.random();
                            if (rand < 0.55) {
                                setBossAction('attacking');
                                setTimeout(() => { damageTarget('party', 0, 300, true); setBossAction(''); }, 400);
                            } else if (rand < 0.8) {
                                setBossAction('aoe');
                                setTimeout(() => { 
                                    [0, 1, 2].forEach(i => damageTarget('party', i, 130, true));
                                    damageTarget('player', null, 100);
                                    setBossAction(''); 
                                }, 600);
                                addLog("Í¥ëÌè¨Ìïú ÌôîÏóº Ïà®Í≤∞!", "warning");
                            } else {
                                const t = Math.floor(Math.random() * 4);
                                setBossAction('attacking');
                                setTimeout(() => { 
                                    if (t === 3) damageTarget('player', null, 180, true);
                                    else damageTarget('party', t, 220, true);
                                    setBossAction(''); 
                                }, 400);
                            }
                        }
                    }, TICK_RATE);
                } else { clearInterval(gameLoopRef.current); }
                return () => clearInterval(gameLoopRef.current);
            }, [gameState, party, bossHp, difficulty, bossMaxHp]);

            useEffect(() => {
                if (bossHp <= 0 && gameState === 'PLAYING') setGameState('WON');
                if ((party.every(m => m.dead) || player.hp <= 0) && gameState === 'PLAYING') setGameState('LOST');
            }, [bossHp, party, player.hp, gameState]);

            const startGame = (diff) => {
                const config = DIFFICULTY_CONFIG[diff];
                setDifficulty(diff);
                setBossMaxHp(config.bossMaxHp);
                setBossHp(config.bossMaxHp);
                setMana(MAX_MANA);
                setPlayer({ hp: 500, maxHp: 500, shield: 0, hot: 0, emoji: 'üßô' });
                setParty([
                    { id: 0, name: 'Ï†ÑÏÇ¨', role: 'Tank', hp: 1200, maxHp: 1200, hot: 0, shield: 0, dead: false, emoji: 'üõ°Ô∏è', key: 'Q', attackProgress: 0 },
                    { id: 1, name: 'ÎèÑÏ†Å', role: 'DPS', hp: 600, maxHp: 600, hot: 0, shield: 0, dead: false, emoji: 'üó°Ô∏è', key: 'W', attackProgress: 0 },
                    { id: 2, name: 'Î≤ïÏÇ¨', role: 'DPS', hp: 450, maxHp: 450, hot: 0, shield: 0, dead: false, emoji: 'ü™Ñ', key: 'E', attackProgress: 0 },
                ]);
                setGameState('PLAYING');
                addLog(`${config.label} ÎÇúÏù¥ÎèÑÎ°ú Ï†ÑÌà¨Î•º ÏãúÏûëÌï©ÎãàÎã§!`, "system");
            };

            return (
                <div className={`min-h-screen bg-slate-950 text-slate-100 p-4 font-sans flex flex-col items-center justify-center select-none overflow-hidden ${isShaking ? 'shake' : ''}`}>
                    {screenFlash && <div className="fixed inset-0 flash-hit z-[100] pointer-events-none" />}
                    
                    <div className="max-w-4xl w-full flex flex-col gap-4 relative">
                        
                        {/* Battle Arena */}
                        <div className="relative h-72 bg-slate-900 rounded-3xl border-4 border-slate-800 shadow-[0_0_50px_rgba(0,0,0,0.5)] overflow-hidden flex flex-col items-center justify-center p-4">
                            {/* Current Difficulty Badge */}
                            <div className="absolute top-4 right-6 flex items-center gap-2 px-3 py-1 bg-black/40 rounded-full border border-slate-700">
                                <Icon name="Trophy" size={14} className={DIFFICULTY_CONFIG[difficulty].color} />
                                <span className={`text-[10px] font-black uppercase ${DIFFICULTY_CONFIG[difficulty].color}`}>
                                    {DIFFICULTY_CONFIG[difficulty].label} Î™®Îìú
                                </span>
                            </div>

                            <div className={`absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] ${bossHp < bossMaxHp * 0.35 ? 'from-red-900/40' : 'from-blue-900/20'} via-transparent to-transparent opacity-50`}></div>
                            
                            {/* Boss */}
                            <div className={`relative transition-all duration-300 mb-8 boss-breathing ${bossAction === 'attacking' ? 'translate-y-6 scale-125' : bossAction === 'aoe' ? 'scale-150' : ''}`}>
                                <div className={`text-9xl filter drop-shadow-[0_0_20px_rgba(239,68,68,0.6)] ${bossHp < bossMaxHp * 0.35 ? 'hue-rotate-[320deg]' : ''}`}>üê≤</div>
                                {combatEffects.filter(e => e.targetId === 'boss').map(effect => (
                                    <div key={effect.id} style={{'--tw-translate-x': effect.x + 'px'}} className={`absolute top-0 left-1/2 -translate-x-1/2 font-black italic animate-float-up z-20 text-red-500 ${effect.isCrit ? 'text-4xl' : 'text-2xl'}`}>{effect.value}</div>
                                ))}
                            </div>

                            <div className="flex gap-12 items-end relative z-20">
                                {party.map((member, i) => (
                                    <div key={member.id} className={`relative flex flex-col items-center transition-all duration-300 ${hitTargets.includes(i) ? 'scale-90 opacity-80' : ''}`}>
                                        <div className={`text-5xl mb-2 transition-transform ${member.dead ? 'grayscale opacity-20 rotate-90 scale-75' : ''} ${selectedTarget === i ? 'drop-shadow-[0_0_12px_rgba(59,130,246,1)] scale-110' : ''}`}>
                                            {member.emoji}
                                        </div>
                                        {combatEffects.filter(e => e.targetId === `p-${i}`).map(effect => (
                                            <div key={effect.id} style={{'--tw-translate-x': effect.x + 'px'}} className={`absolute -top-12 left-1/2 font-bold whitespace-nowrap animate-float-up z-30 ${effect.type === 'damage' ? 'text-red-500' : effect.type === 'heal' ? 'text-green-400' : 'text-blue-400'}`}>{effect.value}</div>
                                        ))}
                                        {selectedTarget === i && !member.dead && <div className="absolute -bottom-3 w-10 h-1.5 bg-blue-500 rounded-full animate-ping"></div>}
                                    </div>
                                ))}
                                <div className={`relative flex flex-col items-center transition-all duration-300 ${hitTargets.includes('player') ? 'scale-90 opacity-80' : ''}`}>
                                    <div className={`text-5xl mb-2 transition-transform ${selectedTarget === 3 ? 'drop-shadow-[0_0_12px_rgba(59,130,246,1)] scale-110' : 'opacity-70'}`}>
                                        {player.emoji}
                                    </div>
                                    {combatEffects.filter(e => e.targetId === `p-player`).map(effect => (
                                        <div key={effect.id} style={{'--tw-translate-x': effect.x + 'px'}} className={`absolute -top-12 left-1/2 font-bold whitespace-nowrap animate-float-up z-30 ${effect.type === 'damage' ? 'text-red-500' : effect.type === 'heal' ? 'text-green-400' : 'text-blue-400'}`}>{effect.value}</div>
                                    ))}
                                    {selectedTarget === 3 && <div className="absolute -bottom-3 w-10 h-1.5 bg-blue-500 rounded-full animate-ping"></div>}
                                </div>
                            </div>
                        </div>

                        {/* Boss HP Bar */}
                        <div className="bg-slate-900/80 rounded-2xl p-4 border-2 border-red-900 shadow-xl overflow-hidden backdrop-blur-md">
                            <div className="flex justify-between items-end mb-2">
                                <h2 className="text-xl font-black text-red-500 flex items-center gap-2"><Icon name="Flame" /> ÎìúÎûòÍ≥§ {bossHp < bossMaxHp * 0.35 && 'Í¥ëÌè≠Ìôî!'}</h2>
                                <div className="text-right font-mono text-lg">{Math.ceil(bossHp).toLocaleString()} HP</div>
                            </div>
                            <div className="w-full bg-slate-800 h-3 rounded-full overflow-hidden">
                                <div className="h-full bg-red-600 transition-all duration-500" style={{ width: `${(bossHp/bossMaxHp)*100}%` }}></div>
                            </div>
                        </div>

                        {/* Status List */}
                        <div className="grid grid-cols-4 gap-3">
                            {party.map((member, idx) => (
                                <div key={member.id} onClick={() => !member.dead && setSelectedTarget(idx)} className={`p-3 rounded-xl border-2 transition-all cursor-pointer ${member.dead ? 'bg-slate-900/30 border-slate-800' : selectedTarget === idx ? 'bg-slate-800 border-blue-500 ring-2 ring-blue-500/20' : 'bg-slate-800/80 border-slate-700'}`}>
                                    <div className="flex justify-between text-[10px] font-bold mb-1"><span>{member.name}</span><span>{member.key}</span></div>
                                    <div className="w-full bg-slate-950 h-4 rounded border border-slate-700 relative overflow-hidden mb-1">
                                        <div className="absolute h-full bg-blue-400/40" style={{ width: `${(member.shield / member.maxHp) * 100}%`, left: `${(member.hp / member.maxHp) * 100}%` }}></div>
                                        <div className={`h-full ${member.hp < member.maxHp * 0.3 ? 'bg-red-600' : 'bg-green-600'}`} style={{ width: `${(member.hp / member.maxHp) * 100}%` }}></div>
                                        <div className="absolute inset-0 flex justify-center items-center text-[9px] font-black">{Math.ceil(member.hp)}</div>
                                    </div>
                                    <div className="w-full bg-slate-950 h-1 rounded-full overflow-hidden">
                                        <div className="h-full bg-yellow-500 attack-gauge" style={{ width: `${member.attackProgress}%` }}></div>
                                    </div>
                                </div>
                            ))}
                            {/* Player Frame */}
                            <div onClick={() => setSelectedTarget(3)} className={`p-3 rounded-xl border-2 transition-all cursor-pointer ${selectedTarget === 3 ? 'bg-slate-800 border-blue-500 ring-2 ring-blue-500/20' : 'bg-blue-900/20 border-blue-900/40'}`}>
                                <div className="flex justify-between text-[10px] font-bold mb-1 text-blue-300"><span>ÌîåÎ†àÏù¥Ïñ¥</span><span>S</span></div>
                                <div className="w-full bg-slate-950 h-4 rounded border border-slate-700 relative overflow-hidden">
                                    <div className="absolute h-full bg-blue-400/40" style={{ width: `${(player.shield / player.maxHp) * 100}%`, left: `${(player.hp / player.maxHp) * 100}%` }}></div>
                                    <div className={`h-full ${player.hp < player.maxHp * 0.3 ? 'bg-red-600' : 'bg-blue-600'}`} style={{ width: `${(player.hp / player.maxHp) * 100}%` }}></div>
                                    <div className="absolute inset-0 flex justify-center items-center text-[9px] font-black">{Math.ceil(player.hp)}</div>
                                </div>
                                <div className="flex gap-1 mt-1.5 h-3">
                                    {player.hot > 0 && <Icon name="Activity" size={10} className="text-green-400" />}
                                    {player.shield > 0 && <Icon name="Shield" size={10} className="text-blue-300" />}
                                </div>
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="bg-slate-900/90 rounded-3xl p-6 border-2 border-slate-700 shadow-2xl flex flex-col md:flex-row gap-6">
                            <div className="flex-1 space-y-4">
                                <div className="flex justify-between items-center text-xs font-black text-blue-400 uppercase tracking-widest">
                                    <span className="flex items-center gap-2"><Icon name="Zap" /> Mana Energy</span>
                                    <span>{Math.floor(mana)} / {MAX_MANA}</span>
                                </div>
                                <div className="w-full bg-slate-950 h-3 rounded-full overflow-hidden border border-slate-800">
                                    <div className="h-full bg-gradient-to-r from-blue-600 to-cyan-400 shadow-[0_0_15px_rgba(59,130,246,0.5)]" style={{ width: `${(mana/MAX_MANA)*100}%` }}></div>
                                </div>
                                <div className="grid grid-cols-4 gap-3">
                                    {Object.entries(SKILL_DATA).map(([id, skill]) => {
                                        const cur = cooldowns[id];
                                        const max = skill.cd * 10;
                                        return (
                                            <button key={id} onClick={() => castSpell(parseInt(id))} disabled={cur > 0 || gameState !== 'PLAYING'} className={`group relative h-20 rounded-2xl border-2 transition-all overflow-hidden ${cur > 0 ? 'bg-slate-950 border-slate-900 opacity-50' : 'bg-slate-800 border-slate-600 hover:border-blue-400 active:scale-95'}`}>
                                                <div className="relative z-10 flex flex-col items-center justify-center h-full">
                                                    <Icon name={skill.icon} className={skill.color} size={24} />
                                                    <span className="text-[10px] font-black mt-1">{skill.name}</span>
                                                    <span className="text-[9px] opacity-40">{skill.key}</span>
                                                </div>
                                                {cur > 0 && (
                                                    <>
                                                        <div className="absolute bottom-0 left-0 w-full bg-blue-600/20 cooldown-overlay" style={{ height: `${(cur/max)*100}%` }}></div>
                                                        <div className="absolute inset-0 flex items-center justify-center z-20 text-2xl font-black">{(cur/10).toFixed(1)}</div>
                                                    </>
                                                )}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                            <div className="w-full md:w-64 bg-black/60 rounded-2xl p-3 border border-slate-800 flex flex-col h-44">
                                <span className="text-[10px] text-slate-500 font-black uppercase mb-2 border-b border-slate-800 pb-1">Combat Records</span>
                                <div className="flex-1 overflow-y-auto space-y-1 text-[11px] scrollbar-hide">
                                    {logs.map((log) => (<div key={log.id} className={log.type === 'error' ? 'text-red-500 font-bold' : log.type === 'warning' ? 'text-orange-400' : log.type === 'success' ? 'text-green-400' : 'text-slate-400'}>{log.msg}</div>))}
                                </div>
                            </div>
                        </div>

                        {/* Overlays */}
                        {gameState !== 'PLAYING' && (
                            <div className="fixed inset-0 bg-black/95 flex items-center justify-center z-[200] p-4 backdrop-blur-xl text-center">
                                <div className="bg-slate-900 p-8 rounded-[3rem] border-4 border-slate-800 max-w-lg w-full shadow-2xl">
                                    <h1 className={`text-5xl font-black mb-6 tracking-tighter ${gameState === 'WON' ? 'text-yellow-400' : gameState === 'LOST' ? 'text-red-600' : 'text-white'}`}>
                                        {gameState === 'START' ? 'MINI HEALER' : gameState === 'WON' ? 'VICTORY' : 'DEFEATED'}
                                    </h1>
                                    
                                    {gameState === 'START' ? (
                                        <div className="space-y-6">
                                            <p className="text-slate-400 text-sm">ÎèÑÏ†ÑÌï† ÎÇúÏù¥ÎèÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. ÎÇúÏù¥ÎèÑÍ∞Ä ÎÜíÏùÑÏàòÎ°ù Î≥¥Ïä§Îäî Í∞ïÎ†•Ìï¥ÏßÄÎ©∞ ÎßàÎÇò Ïû¨ÏÉùÏùÄ ÎäêÎ†§ÏßëÎãàÎã§.</p>
                                            <div className="grid grid-cols-3 gap-3">
                                                {Object.entries(DIFFICULTY_CONFIG).map(([key, config]) => (
                                                    <button 
                                                        key={key} 
                                                        onClick={() => startGame(key)}
                                                        className={`py-4 rounded-2xl font-black text-white transition-all hover:scale-105 active:scale-95 border-b-4 border-black/30 ${config.bgColor}`}
                                                    >
                                                        {config.label}
                                                    </button>
                                                ))}
                                            </div>
                                            <div className="bg-black/50 p-4 rounded-2xl border border-slate-800 text-[10px] text-left space-y-1 mt-4">
                                                <p>‚å®Ô∏è <span className="text-white font-bold">1,2,3,4</span> : Ïä§ÌÇ¨ ÏÇ¨Ïö©</p>
                                                <p>‚å®Ô∏è <span className="text-white font-bold">Q,W,E</span> : ÌååÌã∞Ïõê ÏÑ†ÌÉù / <span className="text-white font-bold">S</span> : Î≥∏Ïù∏ ÏÑ†ÌÉù</p>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-6">
                                            <p className="text-slate-400">{gameState === 'WON' ? "ÏúÑÎåÄÌïú ÏπòÏú†ÏÇ¨Ïó¨, ÎãπÏã†Ïù¥ ÏÑ∏ÏÉÅÏùÑ Íµ¨ÌñàÏäµÎãàÎã§!" : "ÎèôÎ£åÎì§Í≥º ÎãπÏã†Ïù¥ Î™®Îëê Ïì∞Îü¨Ï°åÏäµÎãàÎã§..."}</p>
                                            <button onClick={() => setGameState('START')} className="w-full py-5 bg-blue-600 hover:bg-blue-500 text-white font-black rounded-2xl text-xl shadow-lg active:scale-95 transition-all">
                                                <Icon name="Sword" size={24} className="inline mr-2" /> Îã§Ïãú ÏãúÏûë
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
